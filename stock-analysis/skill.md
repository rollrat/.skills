---
name: stock-analysis
description: 기업 종합 분석을 멀티 에이전트로 수행하고, Obsidian 볼트의 stock-analysis/ 폴더에 저장합니다. /stock-analysis <ticker_or_company> 로 실행.
---

# Stock Analysis - 멀티 에이전트 기업 종합 분석

## Overview

여러 에이전트를 병렬로 실행하여 기업을 다각도로 분석하고, 결과를 종합하여 Obsidian 볼트의 `stock-analysis/` 폴더에 저장합니다.

## Usage

```
/stock-analysis <ticker_or_company> [options]
```

### Options
- `<ticker>`: 종목 티커 (예: AAPL, TSLA, ZETA)
- `<company>`: 회사명 (예: "Zeta Platforms", "Apple")
- `--agents <n>`: 에이전트 수 (2~5, 기본: 3)
- `--model <model>`: 에이전트 모델 (haiku, sonnet, opus. 기본: haiku)
- `--deep`: 심층 분석 모드 (에이전트 5개, model sonnet)
- `--quick`: 빠른 분석 모드 (에이전트 2개, model haiku)

## Critical Rules

### 비용 관리
- 기본 모드에서 에이전트는 **haiku** 모델을 사용한다 (비용 절감).
- `--deep` 모드에서만 sonnet을 사용한다.
- 각 에이전트 프롬프트에 **"웹서치는 최대 3회, 웹페이지 fetch는 최대 2회로 제한"**을 명시한다.

### 에이전트 수 제한
- 최대 5개를 넘지 않는다.
- 기본: 3개 (사업+재무 / 뉴스+주가 / 리스크+경쟁)
- `--quick`: 2개 (사업+재무+밸류에이션 / 리스크+뉴스)
- `--deep`: 5개 (사업 / 재무 / 뉴스 / 주가 / 리스크+경쟁)

### 문서 생성 규칙
- 에이전트 결과를 **메인 컨텍스트에서 종합**하여 하나의 문서로 만든다.
- 에이전트 출력을 그대로 붙여넣지 않고, 핵심만 추출하여 재구성한다.

### 투자 조언 면책
- 문서 하단에 면책 문구를 반드시 포함한다.

## Workflow

### 1. 입력 파싱

사용자 입력에서 티커/회사명과 옵션을 파싱한다.
- 티커가 명확하면 그대로 사용
- 회사명만 있으면 에이전트가 티커를 확인

### 2. 에이전트 병렬 실행

**모든 에이전트를 하나의 메시지에서 동시에 Task 호출한다 (병렬 실행).**

각 에이전트 프롬프트에 반드시 포함할 공통 지시:
```
조사 대상: {company} (ticker: {ticker})
웹서치는 최대 3회, 웹페이지 fetch는 최대 2회로 제한하라.
핵심 숫자와 팩트 위주로 간결하게 정리하라.
한국어로 작성하라.
```

#### 기본 모드 (3 에이전트)

**에이전트 1: 사업 개요 + 재무 분석**
```
{company} ({ticker}) 기업을 조사하라.

1. 회사 개요: 무슨 회사인지, 핵심 사업, 주요 제품/서비스
2. 비즈니스 모델: 수익 구조, 과금 방식
3. 매출 추이 (최근 3년), 매출 성장률
4. 수익성: Adj. EBITDA, 순이익, 마진 추이
5. 현금흐름: FCF, 부채비율, 재무 건전성
6. 밸류에이션: P/E, P/S, EV/EBITDA
7. 가장 최근 분기 실적 핵심 숫자

숫자와 테이블 위주로 간결하게 정리하라.
```

**에이전트 2: 뉴스 + 주가**
```
{company} ({ticker}) 최근 동향을 조사하라.

1. 현재 주가, 시가총액, 52주 범위
2. 최근 6개월 주요 뉴스 3~5개 (M&A, 파트너십, 제품 출시 등)
3. 애널리스트 컨센서스: 목표주가, Buy/Hold/Sell 비율
4. 기관투자자 보유 비율, 공매도 비율
5. 다가오는 주요 카탈리스트 (실적 발표일 등)

핵심만 간결하게 정리하라.
```

**에이전트 3: 리스크 + 경쟁 환경**
```
{company} ({ticker}) 리스크와 경쟁 환경을 분석하라.

1. 주요 투자 리스크 3~5개 (사업/재무/규제)
2. 주요 경쟁사 3~5개와 포지셔닝 비교
3. 산업/시장 전망 (TAM, 성장률)
4. Bull case 핵심 근거 3개
5. Bear case 핵심 근거 3개
6. 종합 투자 매력도 한줄 평가

간결하게 정리하라.
```

#### Quick 모드 (2 에이전트)

**에이전트 1**: 사업+재무+밸류에이션 (위 에이전트 1의 내용)
**에이전트 2**: 리스크+뉴스+주가 (위 에이전트 2+3 결합)

#### Deep 모드 (5 에이전트)

**에이전트 1**: 사업 개요 (회사 소개, 제품, 비즈니스 모델, 경쟁 우위)
**에이전트 2**: 재무 분석 (매출, 수익성, 현금흐름, 밸류에이션, 최근 실적)
**에이전트 3**: 최근 뉴스 (6개월 내 주요 뉴스, M&A, AI 전략, 경영진 변동)
**에이전트 4**: 주가/시장 평가 (주가, 52주 범위, 애널리스트, 기관, 공매도, 동종 비교)
**에이전트 5**: 리스크/경쟁 (리스크 요인, 경쟁사 비교, 산업 전망, Bull/Bear case)

Deep 모드 에이전트는 각각 웹서치 최대 5회, fetch 최대 3회로 허용한다.

### 3. 결과 종합 & 문서 생성

에이전트 결과를 수신한 후, **메인 컨텍스트에서** 아래 템플릿에 맞춰 종합 문서를 작성한다.

Obsidian 볼트 저장 경로: `stock-analysis/{Company Name} ({TICKER}) 종합 분석.md`

#### 마크다운 템플릿

```markdown
---
tags:
  - stock-analysis
  - {TICKER}
  - {sector}
ticker: "{TICKER}"
company: "{Company Name}"
exchange: "{거래소}"
sector: "{섹터}"
analysis_date: "{YYYY-MM-DD}"
next_earnings: "{다음 실적 발표일 - 알 수 있는 경우}"
verdict: "{한줄 투자 판단}"
---

# {Company Name} ({Exchange}: {TICKER}) 종합 기업 분석

> 분석일: {YYYY-MM-DD} | 차기 실적 발표: {날짜 또는 "미정"}

---

## 1. 회사 개요

| 항목 | 내용 |
|------|------|
| **설립** | {설립 연도 및 간략 연혁} |
| **상장** | {상장일 및 거래소} |
| **본사** | {소재지} |
| **CEO** | {CEO 이름} |
| **핵심 사업** | {1줄 요약} |
| **시가총액** | {금액} |

{2-3문장 회사 설명}

### 핵심 제품/서비스
- {제품1}: {설명}
- {제품2}: {설명}
- ...

### 비즈니스 모델
| 구분 | 비중 | 설명 |
|------|------|------|
| {매출원1} | {%} | {설명} |
| {매출원2} | {%} | {설명} |

---

## 2. 재무 분석

### 매출 추이

| 연도 | 매출 | YoY 성장률 |
|------|------|-----------|
| {년도} | {금액} | {%} |
| ... | ... | ... |

### 수익성

| 연도 | Adj. EBITDA | 마진 |
|------|-------------|------|
| {년도} | {금액} | {%} |
| ... | ... | ... |

### 현금흐름 및 재무 건전성

| 항목 | 수치 |
|------|------|
| FCF | {금액} |
| 부채비율 (D/E) | {%} |
| 레버리지 비율 | {x} |

---

## 3. 밸류에이션 & 주가

| 항목 | 수치 |
|------|------|
| **현재 주가** | {금액} |
| **시가총액** | {금액} |
| **52주 최고/최저** | {금액} / {금액} |
| **P/S** | {x} |
| **P/E** | {x} |
| **EV/EBITDA** | {x} |

### 애널리스트 컨센서스

| 항목 | 수치 |
|------|------|
| 컨센서스 등급 | {등급} |
| 평균 목표주가 | {금액} (현재 대비 {+-%}) |
| Buy/Hold/Sell | {%}/{%}/{%} |

### 기관/공매도

| 항목 | 수치 |
|------|------|
| 기관투자자 보유 | {%} |
| 인사이더 보유 | {%} |
| 공매도 비율 | {%} |

### 동종업계 비교

| 기업 | 티커 | 시가총액 | P/S | 1년 수익률 |
|------|------|----------|-----|-----------|
| **{대상기업}** | {TICKER} | {금액} | {x} | {%} |
| {경쟁사1} | {ticker} | {금액} | {x} | {%} |
| ... | ... | ... | ... | ... |

---

## 4. 최근 주요 이벤트

{최근 6개월 내 주요 뉴스/이벤트를 시간순 또는 중요도순으로 나열}

### {이벤트1 제목}
- {핵심 내용 2-3문장}

### {이벤트2 제목}
- {핵심 내용 2-3문장}

...

---

## 5. 경쟁 우위 (해자, Moat)

1. **{강점1}**: {설명}
2. **{강점2}**: {설명}
3. **{강점3}**: {설명}

---

## 6. 리스크 분석

### 사업 리스크
- {리스크1}
- {리스크2}

### 재무 리스크
- {리스크1}
- {리스크2}

### 규제/경쟁 리스크
- {리스크1}
- {리스크2}

---

## 7. 투자 판단: Bull vs Bear

### Bull Case
- {근거1}
- {근거2}
- {근거3}

### Bear Case
- {근거1}
- {근거2}
- {근거3}

---

## 8. 종합 의견

{3-5문장으로 투자 매력도 종합 판단. "고위험-고수익", "안정적 성장", "밸류에이션 부담" 등 한줄 태그 포함}

### 핵심 카탈리스트

| 시기 | 이벤트 | 기대 |
|------|--------|------|
| {시기} | {이벤트} | {기대 효과} |
| ... | ... | ... |

---

*본 분석은 투자 권유가 아닌 정보 제공 목적이며, 투자 판단은 본인의 책임입니다.*
```

### 4. Obsidian 저장

Obsidian MCP의 `write_note`로 저장한다.
- 경로: `stock-analysis/{Company Name} ({TICKER}) 종합 분석.md`
- 이미 동일 파일이 있으면 덮어쓴다 (최신 분석으로 갱신)

## 인자 없이 실행 시 동작

**`/stock-analysis`를 인자 없이 실행하면 아래 안내를 출력하고 즉시 종료한다.**

출력 형식 (정확히 이대로 출력):

```
📊 Stock Analysis - 멀티 에이전트 기업 종합 분석

사용법:
  /stock-analysis AAPL                    — Apple 기본 분석 (3 에이전트, haiku)
  /stock-analysis TSLA --deep             — Tesla 심층 분석 (5 에이전트, sonnet)
  /stock-analysis ZETA --quick            — Zeta 빠른 분석 (2 에이전트, haiku)
  /stock-analysis "Zeta Platforms"        — 회사명으로 검색
  /stock-analysis NVDA --agents 4         — 에이전트 수 직접 지정

모드 비교:
  --quick   2 에이전트, haiku    — 빠르고 저렴. 대략적 파악용
  (기본)    3 에이전트, haiku    — 균형 잡힌 분석
  --deep    5 에이전트, sonnet   — 상세 분석. 비용 높음

결과는 Obsidian 볼트의 stock-analysis/ 폴더에 저장됩니다.
```

**이 안내만 출력하고 종료한다. 에이전트 실행 등 어떤 동작도 하지 않는다.**

## Implementation Notes

Claude가 이 skill을 실행할 때:

1. **인자 확인**: 인자가 없으면 위의 안내를 출력하고 즉시 종료.
2. **옵션 파싱**: `--deep`, `--quick`, `--agents`, `--model` 확인.
3. **에이전트 병렬 실행**: 모드에 따른 에이전트 수만큼 Task 도구를 **하나의 메시지에서 동시 호출**한다.
   - `subagent_type`: `general-purpose`
   - `model`: 기본 `haiku`, `--deep`이면 `sonnet`, `--model`로 오버라이드 가능
   - 각 에이전트 프롬프트에 웹서치/fetch 횟수 제한을 명시한다.
4. **결과 종합**: 에이전트 응답을 받은 후, 메인 컨텍스트에서 템플릿에 맞춰 종합 문서를 작성한다. 에이전트 출력을 그대로 붙이지 않고 핵심을 추출하여 재구성한다.
5. **Obsidian 저장**: Obsidian MCP의 `write_note`로 저장한다. frontmatter에 tags, ticker, company, analysis_date, verdict 등을 포함한다.
6. **완료 보고**: 저장 경로와 핵심 결론(verdict)을 사용자에게 출력한다.

## Error Handling

- **에이전트 실패**: 일부 에이전트가 실패해도 성공한 에이전트 결과로 문서를 생성한다. 누락된 섹션은 "데이터 수집 실패"로 표시.
- **Obsidian 볼트 없음**: 볼트 경로 확인 안내 후 중단.
- **티커 불명확**: 사용자에게 정확한 티커를 확인 질문.
